{"visual":{"name":"Chat PPA","displayName":"Chat PPA","guid":"ChatPPA123456","visualClassName":"Visual","version":"1.0.0.0","description":"Chat PPA com ChatGPT","supportUrl":"https://openai.com","gitHubUrl":""},"author":{"name":"Minist√©rio do Planejamento e Or√ßamento","email":"exemplo@openai.com"},"apiVersion":"5.3.0","style":"style/visual.less","stringResources":{},"capabilities":{"objects":{"apiSettings":{"displayName":"API Settings","description":"Configura√ß√µes para conectar √† API OpenAI","displayNameKey":"Visual_ApiSettings","descriptionKey":"Visual_ApiSettings_Description","properties":{"openAiKey":{"displayName":"OpenAI API Key","description":"Chave da API para autentica√ß√£o com OpenAI","displayNameKey":"Visual_OpenAIKey","descriptionKey":"Visual_OpenAIKey_Description","type":{"text":true}},"modelo":{"displayName":"Modelo","description":"Modelo da OpenAI a ser usado","displayNameKey":"Visual_Modelo","descriptionKey":"Visual_Modelo_Description","type":{"text":true}},"assistantId":{"displayName":"Assistant ID","description":"ID do assistente a ser usado","displayNameKey":"Visual_AssistantID","descriptionKey":"Visual_AssistantID_Description","type":{"text":true}},"debug":{"displayName":"Debug","description":"Ativa ou desativa o modo de debug","displayNameKey":"Visual_Debug","descriptionKey":"Visual_Debug_Description","type":{"text":true}},"fontSize":{"displayName":"Tamanho da Fonte","description":"Tamanho da fonte para exibi√ß√£o","displayNameKey":"Visual_FontSize","descriptionKey":"Visual_FontSize_Description","type":{"numeric":true}}}}},"privileges":[{"name":"WebAccess"}]},"content":{"js":"var ChatPPA123456;(()=>{\"use strict\";var t={848:(t,e,s)=>{s.d(e,{b:()=>a});class a{target;textarea;button;clearButton;cancelButton;statusOutput;resultOutput;debugOutput;host;abortController;apiKey=\"\";assistantId=\"\";modelo=\"\";debug=\"true\";fontSize=14;constructor(t){this.target=t.element,this.host=t.host;const e=document.createElement(\"div\");e.className=\"chat-container\",this.textarea=document.createElement(\"textarea\"),this.textarea.className=\"chat-input\",this.textarea.placeholder=\"Digite sua pergunta...\",this.textarea.rows=1,this.textarea.addEventListener(\"input\",()=>{this.textarea.style.height=\"auto\",this.textarea.style.height=this.textarea.scrollHeight+\"px\"}),this.button=document.createElement(\"button\"),this.button.textContent=\"Perguntar\",this.clearButton=document.createElement(\"button\"),this.clearButton.textContent=\"Limpar\",this.clearButton.onclick=()=>{this.textarea.value=\"\",this.clearLogs(\"status\"),this.clearLogs(\"result\"),this.clearLogs(\"debug\")},this.cancelButton=document.createElement(\"button\"),this.cancelButton.textContent=\"Interromper\",this.cancelButton.disabled=!0,this.cancelButton.onclick=()=>{this.abortController&&(this.abortController.abort(),this.cancelButton.disabled=!0,this.button.disabled=!1,this.logOutput(\"‚õî Requisi√ß√£o cancelada pelo usu√°rio.\",\"status\"))};const s=document.createElement(\"div\");s.className=\"chat-buttons\",s.appendChild(this.button),s.appendChild(this.cancelButton),s.appendChild(this.clearButton),this.statusOutput=document.createElement(\"div\"),this.statusOutput.className=\"chat-status\",this.resultOutput=document.createElement(\"div\"),this.resultOutput.className=\"chat-result\",this.debugOutput=document.createElement(\"div\"),this.debugOutput.className=\"chat-debug\",e.appendChild(this.textarea),e.appendChild(s),e.appendChild(this.statusOutput),e.appendChild(this.resultOutput),e.appendChild(this.debugOutput),this.target.appendChild(e),this.button.onclick=async()=>{if(this.button.disabled=!0,this.cancelButton.disabled=!1,this.abortController=new AbortController,!(this.textarea&&this.apiKey&&this.assistantId&&this.modelo))return this.logOutput(\"Preencha todos os campos no painel de formata√ß√£o.\",\"status\"),this.button.disabled=!1,void(this.cancelButton.disabled=!0);this.clearLogs(\"status\"),this.logOutput(\"‚è≥ Criando nova thread...\",\"status\");try{const t=await fetch(\"https://api.openai.com/v1/threads\",{method:\"POST\",headers:{Authorization:`Bearer ${this.apiKey}`,\"Content-Type\":\"application/json\",\"OpenAI-Beta\":\"assistants=v2\"},signal:this.abortController.signal}),e=(await t.json()).id;this.logOutput(\"üì§ Enviando pergunta...\",\"status\"),\"true\"==this.debug&&this.logOutput(\"Thread ID: \"+e,\"debug\"),await fetch(`https://api.openai.com/v1/threads/${e}/messages`,{method:\"POST\",headers:{Authorization:`Bearer ${this.apiKey}`,\"Content-Type\":\"application/json\",\"OpenAI-Beta\":\"assistants=v2\"},body:JSON.stringify({role:\"user\",content:this.textarea.value}),signal:this.abortController.signal});const s=await fetch(`https://api.openai.com/v1/threads/${e}/runs`,{method:\"POST\",headers:{Authorization:`Bearer ${this.apiKey}`,\"Content-Type\":\"application/json\",\"OpenAI-Beta\":\"assistants=v2\"},body:JSON.stringify({assistant_id:this.assistantId}),signal:this.abortController.signal}),a=(await s.json()).id;let i=\"\",n=0;do{const t=await fetch(`https://api.openai.com/v1/threads/${e}/runs/${a}`,{headers:{Authorization:`Bearer ${this.apiKey}`,\"OpenAI-Beta\":\"assistants=v2\"},signal:this.abortController.signal});i=(await t.json()).status,\"completed\"!==i&&await new Promise(t=>setTimeout(t,1500)),n++}while(\"completed\"!==i&&n<20);const o=await fetch(`https://api.openai.com/v1/threads/${e}/messages`,{headers:{Authorization:`Bearer ${this.apiKey}`,\"OpenAI-Beta\":\"assistants=v2\"},signal:this.abortController.signal}),r=(await o.json()).data.reverse().find(t=>\"assistant\"===t.role);this.clearLogs(\"status\"),this.logOutput(r?.content[0]?.text?.value||\"Sem resposta.\",\"result\")}catch(t){\"AbortError\"===t.name?this.logOutput(\"‚õî Requisi√ß√£o cancelada.\",\"status\"):(this.logOutput(\"‚ùå Erro ao processar a requisi√ß√£o.\",\"result\"),this.logOutput(t.message,\"debug\"))}finally{this.abortController=void 0,this.cancelButton.disabled=!0,this.button.disabled=!1}}}logOutput(t,e){const s=document.createElement(\"pre\");s.style.margin=\"0\",s.style.setProperty(\"font-size\",`${this.fontSize}px`,\"important\"),s.style.lineHeight=\"1.3em\",s.innerText=t,\"status\"===e?(this.statusOutput.innerHTML=\"\",this.statusOutput.appendChild(s)):\"result\"===e?this.resultOutput.appendChild(s):\"debug\"===e&&\"true\"===this.debug&&this.debugOutput.appendChild(s)}clearLogs(t){\"status\"===t&&(this.statusOutput.innerHTML=\"\"),\"result\"===t&&(this.resultOutput.innerHTML=\"\"),\"debug\"===t&&(this.debugOutput.innerHTML=\"\")}update(t){const e=t.dataViews[0]?.metadata?.objects;e&&(this.debug=i(e,\"apiSettings\",\"debug\",\"true\"),this.apiKey=i(e,\"apiSettings\",\"openAiKey\",\"\"),this.modelo=i(e,\"apiSettings\",\"modelo\",\"\"),this.assistantId=i(e,\"apiSettings\",\"assistantId\",\"\"),this.fontSize=i(e,\"apiSettings\",\"fontSize\",14),this.textarea&&this.textarea.style.setProperty(\"font-size\",`${this.fontSize}px`,\"important\"),this.target.querySelectorAll(\"*\").forEach(t=>{const e=t.tagName.toLowerCase();[\"p\",\"pre\",\"div\",\"span\",\"button\",\"label\"].includes(e)&&t.style.setProperty(\"font-size\",`${this.fontSize}px`,\"important\")}))}enumerateObjectInstances(t){const e=[];return\"apiSettings\"===t.objectName&&e.push({objectName:t.objectName,properties:{debug:this.debug,openAiKey:this.apiKey,modelo:this.modelo,assistantId:this.assistantId,fontSize:this.fontSize},selector:null}),e}}function i(t,e,s,a){return t?.[e]?.[s]??a}}},e={};function s(a){var i=e[a];if(void 0!==i)return i.exports;var n=e[a]={exports:{}};return t[a](n,n.exports,s),n.exports}s.d=(t,e)=>{for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})};var a={};(()=>{s.r(a),s.d(a,{default:()=>n});var t=s(848),e=window.powerbi,i={name:\"ChatPPA123456\",displayName:\"Chat PPA\",class:\"Visual\",apiVersion:\"5.3.0\",create:e=>{if(t.b)return new t.b(e);throw\"Visual instance not found\"},createModalDialog:(t,e,s)=>{const a=globalThis.dialogRegistry;t in a&&new a[t](e,s)},custom:!0};void 0!==e&&(e.visuals=e.visuals||{},e.visuals.plugins=e.visuals.plugins||{},e.visuals.plugins.ChatPPA123456=i);const n=i})(),ChatPPA123456=a})();","css":".chat-container {\n  height: 100%;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  font-family: 'Segoe UI', sans-serif;\n}\n.chat-input {\n  resize: none;\n  padding: 6px;\n  font-family: 'Courier New', monospace;\n  overflow-y: auto;\n  overflow-x: hidden;\n  word-break: break-word;\n}\n.chat-buttons {\n  display: flex;\n  gap: 8px;\n  margin-top: 8px;\n}\n.chat-buttons button {\n  width: auto;\n  max-width: 200px;\n  padding: 6px 16px;\n  font-size: 13px;\n  font-weight: 600;\n  border-radius: 2px;\n  border: none;\n  cursor: pointer;\n  background-color: #0078d4;\n  color: white;\n  transition: background-color 0.2s ease;\n}\n.chat-buttons button:hover {\n  background-color: #106ebe;\n}\n.chat-buttons button:active {\n  background-color: #005a9e;\n}\n.chat-buttons button:disabled {\n  background-color: #c8c8c8;\n  cursor: not-allowed;\n}\n/* √Åreas de sa√≠da */\n.chat-status,\n.chat-result,\n.chat-debug {\n  overflow-x: auto;\n  overflow-y: auto;\n  white-space: pre-wrap;\n  word-break: break-word;\n  flex: 1 1 auto;\n  padding: 6px;\n  margin-top: 6px;\n  border: 1px solid #ccc;\n  border-radius: 3px;\n  max-height: 150px;\n}\n.chat-debug {\n  background-color: #f9f9f9;\n  font-size: 12px;\n  color: #666;\n}\n\n","iconBase64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpBOEJGMzkxN0NBRDNFMDExQTcxQ0JFODI3ODBCQUE5RSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo3NEY1QjA1NUQ0OTAxMUUwQTgxREI2NjMxMkNEMUNEMyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo3NEY1QjA1NEQ0OTAxMUUwQTgxREI2NjMxMkNEMUNEMyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IFdpbmRvd3MiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5Mjk5RDU1ODBGRDRFMDExQTcxQ0JFODI3ODBCQUE5RSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBOEJGMzkxN0NBRDNFMDExQTcxQ0JFODI3ODBCQUE5RSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpDoNX0AAAI3SURBVHjarJRLSFVRFIY9t7SiRDGLoEEPCRJRaCSYkxCiFCXCF+LIMExQLkilgumgwkbdBuWDRC2EomhURCOjgagkXEgKLUKhidobM6H0+i34rxyPnuvEA5/rXPda/1l7739vJxKJxG3ls93+hEKhTILxJhgMftmsiPxdhHw4CfepeR8dCyjWwwB0kZy3iVgCoQ2ewnmXxhrBD7Cgr/ZQVA17fDRPw2UYhzK6G99IsBse6/0QNME+H8FT4EA/YiPqOgA1q4IMzBNuw6iKjkCpj+Av+AdnEEmD3bxfhzvuDk30HaEaLsEkXCO53rN+Bwg5qsvTuj/TjGYtx9nINhRmEx7AYWiFW7AXOuEcbPOUvIZ2mnrl+PkQUbNEh4QHNKUSDdsSBWEOlmxTEfvs26FL9Khe211if6Acgee+xo7xzMgBxfq9qPe3fgWBGN2lEnqtG9nExM7CV3jp3bDos2bKJB0nHFRxAxRpA/5CIXyHh5ABv6GZqd9dJ6iz2SjbxMMypGhJFtTlNzu3kK7xgDxpove8U66FK2A+s6nul5gVVMEL+Ak7lG/T+g9JcIOGar2CRUoogxMwpP/bLTJMB9bRhDbkk5bBUU0y3ES0xS04CBfN9RSHiY90vJK0BHaSzG9h2eejS3RJeVfdtrGzuGyd8CX7Yq6ExuCH63jaVMPkFOv6OibB6DKs2+VEQp+WYBoqERn2sVWWRNN0YurIfeL14U6YkpkLYCSG6e0yqdCxvKBLIm5FgAEAV0nKuwMYRUsAAAAASUVORK5CYII="},"visualEntryPoint":""}